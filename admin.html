<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - OFF-THE-RECORD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background-color: #fefefe;
            color: #333;
            line-height: 1.4;
            padding: 30px;
        }

        h1 {
            font-size: 20px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .container {
            display: flex;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .left-panel {
            width: 280px;
            flex-shrink: 0;
        }

        .right-panel {
            flex: 1;
            min-width: 0;
        }

        .toggle-group {
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .toggle-header {
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 11px;
            margin-bottom: 10px;
        }

        .toggle-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .toggle-row:last-child {
            margin-bottom: 0;
        }

        .toggle-label {
            font-size: 12px;
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 22px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 22px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #333;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(18px);
        }

        .quick-links {
            margin-top: 15px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .quick-links a {
            display: block;
            margin-bottom: 6px;
            color: #333;
            text-decoration: underline;
            font-size: 12px;
        }

        .quick-links a:last-child {
            margin-bottom: 0;
        }

        /* Right Panel - Media Catalog */
        .catalog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .catalog-title {
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .add-btn {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 16px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .add-btn:hover {
            background: #555;
        }

        .catalog-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .catalog-table th {
            text-align: left;
            padding: 10px 8px;
            border-bottom: 2px solid #333;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 11px;
            cursor: pointer;
            user-select: none;
        }

        .catalog-table th:hover {
            background: #f5f5f5;
        }

        .catalog-table th .sort-arrow {
            margin-left: 4px;
            opacity: 0.3;
        }

        .catalog-table th.sorted .sort-arrow {
            opacity: 1;
        }

        .catalog-table td {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .catalog-table tr:hover {
            background: #f9f9f9;
        }

        .emoji-cell {
            font-size: 16px;
            text-align: center;
            width: 50px;
        }

        /* Add Media Form */
        .add-form {
            display: none;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        .add-form.active {
            display: block;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            font-size: 11px;
            text-transform: uppercase;
            margin-bottom: 4px;
            letter-spacing: 1px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            font-family: inherit;
            font-size: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .form-actions button {
            padding: 8px 16px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            border-radius: 4px;
            border: 1px solid #333;
        }

        .btn-generate {
            background: #333;
            color: #fff;
        }

        .btn-cancel {
            background: #fff;
            color: #333;
        }

        .output-code {
            margin-top: 15px;
            padding: 15px;
            background: #1a1a1a;
            color: #0f0;
            font-size: 11px;
            border-radius: 4px;
            white-space: pre-wrap;
            word-break: break-all;
            display: none;
        }

        .output-code.active {
            display: block;
        }

        .copy-btn {
            margin-top: 10px;
            padding: 6px 12px;
            font-size: 11px;
            cursor: pointer;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
        }

        .output-section {
            margin-top: 20px;
        }

        .step-box {
            margin-bottom: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .step-label {
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            color: #333;
        }

        .step-box .output-code {
            display: block;
            margin: 0;
            padding: 12px;
            font-size: 12px;
        }

        .step-box .copy-btn {
            margin-top: 8px;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #333;
            text-decoration: underline;
            font-size: 12px;
        }

        /* Chapter Locking */
        .lock-actions {
            display: flex;
            gap: 8px;
        }

        .lock-btn {
            background: #fff;
            color: #333;
            border: 1px solid #333;
            padding: 6px 12px;
            font-family: inherit;
            font-size: 11px;
            cursor: pointer;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .lock-btn:hover {
            background: #333;
            color: #fff;
        }

        .chapter-lock-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(15, auto);
            grid-auto-flow: column;
            gap: 8px;
            margin-bottom: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .chapter-lock-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: #f9f9f9;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .chapter-lock-item:hover {
            background: #eee;
        }

        .chapter-lock-item.locked {
            background: #ffe5e5;
        }

        .chapter-lock-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .chapter-lock-item .chapter-num {
            font-weight: bold;
            color: #666;
            min-width: 24px;
        }

        .chapter-lock-item .chapter-title {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chapter-lock-item .chapter-title a {
            color: inherit;
            text-decoration: none;
        }

        .chapter-lock-item .chapter-title a:hover {
            text-decoration: underline;
            color: #0066cc;
        }

        .save-indicator {
            color: #28a745;
            font-size: 12px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            margin-right: 10px;
        }

        .save-indicator.show {
            opacity: 1;
        }

        .chapter-lock-item .lock-icon {
            font-size: 14px;
            opacity: 0;
        }

        .chapter-lock-item.locked .lock-icon {
            opacity: 1;
        }

        @media (max-width: 800px) {
            .container {
                flex-direction: column;
            }
            .left-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Admin Panel</h1>

    <div class="container">
        <div class="left-panel">
            <div class="toggle-group">
                <div class="toggle-header">Toggles</div>
                <div class="toggle-row">
                    <span class="toggle-label">Maintenance Mode</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showOverload">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Locked Previews</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showLockedPreviews">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="toggle-group">
                <div class="toggle-header">Features</div>
                <div class="toggle-row">
                    <span class="toggle-label">Media Captions</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="showCaptions">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Dark Mode</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowDarkMode" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Page Mode</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowPageMode" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Font Size</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowFontSize" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Bookmarks</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="allowBookmarks" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="toggle-group">
                <div class="toggle-header">Home Page</div>
                <div class="toggle-row">
                    <span class="toggle-label">Random Button</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="randomButtonText">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="toggle-row">
                    <span class="toggle-label">Credential Carousel</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="credentialCarousel">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <div class="quick-links">
                <div class="toggle-header">Quick Links</div>
                <a href="./full-book.html">Full Book</a>
                <a href="./maintenance.html">Maintenance Page</a>
                <a href="./">Back to Site</a>
            </div>
        </div>

        <div class="right-panel">
            <!-- Chapter Locking Section -->
            <div class="catalog-header">
                <span class="catalog-title">Chapter Locking</span>
                <div class="lock-actions">
                    <span class="save-indicator" id="saveIndicator">Saved!</span>
                    <button class="lock-btn" id="lockAllBtn">Lock All</button>
                    <button class="lock-btn" id="unlockAllBtn">Unlock All</button>
                </div>
            </div>

            <div class="chapter-lock-list" id="chapterLockList">
                <!-- Populated dynamically -->
            </div>

            <div style="margin: 30px 0; border-top: 2px solid #333;"></div>

            <div class="catalog-header">
                <span class="catalog-title">Media Catalog</span>
                <button class="add-btn" id="addMediaBtn">+ Add Media</button>
            </div>

            <div class="add-form" id="addForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Chapter</label>
                        <select id="mediaChapter">
                            <option value="">Select chapter...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select id="mediaType">
                            <option value="photo">Photo</option>
                            <option value="newspaper">Newspaper</option>
                            <option value="link">Link</option>
                            <option value="tweet">Tweet</option>
                            <option value="email">Email</option>
                            <option value="text">Text Message</option>
                            <option value="video">Video</option>
                            <option value="audio">Audio</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Caption (what shows when clicked)</label>
                        <input type="text" id="mediaCaption" placeholder="e.g., Tigers dugout, 2019">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>File Name (in assets folder)</label>
                        <input type="text" id="mediaSrc" placeholder="e.g., dugout-photo.jpg">
                    </div>
                </div>
                <div class="form-actions">
                    <button class="btn-generate" id="generateBtn">Generate Code</button>
                    <button class="btn-cancel" id="cancelBtn">Cancel</button>
                </div>

                <div class="output-section" id="outputSection" style="display:none;">
                    <div class="step-box">
                        <div class="step-label">STEP 1: Add to data/media.js</div>
                        <div class="output-code" id="mediaCode"></div>
                        <button class="copy-btn" data-target="mediaCode">Copy</button>
                    </div>
                    <div class="step-box">
                        <div class="step-label">STEP 2: Paste in chapter text where you want the emoji</div>
                        <div class="output-code" id="spanCode"></div>
                        <button class="copy-btn" data-target="spanCode">Copy</button>
                    </div>
                </div>
            </div>

            <table class="catalog-table" id="catalogTable">
                <thead>
                    <tr>
                        <th data-sort="icon">Icon <span class="sort-arrow">â†•</span></th>
                        <th data-sort="id">Media ID <span class="sort-arrow">â†•</span></th>
                        <th data-sort="chapter">Chapter <span class="sort-arrow">â†•</span></th>
                        <th data-sort="type">Type <span class="sort-arrow">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="catalogBody">
                    <!-- Populated dynamically from media.js -->
                </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { MEDIA_CONTENT } from './data/media.js';
        import { CHAPTERS } from './data/chapters.js';

        // Chapter titles for lookups
        const chapterTitles = CHAPTERS.map(ch => ch.title);

        // ====== CHAPTER LOCKING ======
        const chapterLockList = document.getElementById('chapterLockList');
        const lockAllBtn = document.getElementById('lockAllBtn');
        const unlockAllBtn = document.getElementById('unlockAllBtn');

        // Load locked chapters from localStorage
        function getLockedChapters() {
            const stored = localStorage.getItem('admin_lockedChapters');
            return stored ? JSON.parse(stored) : [];
        }

        // Save locked chapters to localStorage
        function saveLockedChapters(lockedIds) {
            localStorage.setItem('admin_lockedChapters', JSON.stringify(lockedIds));
            showSaveIndicator();
        }

        // Show save indicator briefly
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            if (indicator) {
                indicator.classList.add('show');
                setTimeout(() => indicator.classList.remove('show'), 1500);
            }
        }

        // Render chapter lock list
        function renderChapterLockList() {
            const lockedChapters = getLockedChapters();

            chapterLockList.innerHTML = CHAPTERS.map((chapter, index) => {
                const chapterId = chapter.id;
                const isLocked = lockedChapters.includes(chapterId);
                return `
                    <label class="chapter-lock-item ${isLocked ? 'locked' : ''}" data-chapter-id="${chapterId}">
                        <input type="checkbox" ${isLocked ? 'checked' : ''}>
                        <span class="chapter-num">${chapterId}</span>
                        <span class="chapter-title"><a href="./full-book.html#chapter-${chapterId}" target="_blank">${chapter.title}</a></span>
                        <span class="lock-icon">ðŸ”’</span>
                    </label>
                `;
            }).join('');

            // Add event listeners
            chapterLockList.querySelectorAll('.chapter-lock-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', () => {
                    const chapterId = parseInt(item.dataset.chapterId);
                    let lockedChapters = getLockedChapters();

                    if (checkbox.checked) {
                        if (!lockedChapters.includes(chapterId)) {
                            lockedChapters.push(chapterId);
                        }
                        item.classList.add('locked');
                    } else {
                        lockedChapters = lockedChapters.filter(id => id !== chapterId);
                        item.classList.remove('locked');
                    }

                    saveLockedChapters(lockedChapters);
                });
            });
        }

        // Lock all chapters
        lockAllBtn.addEventListener('click', () => {
            const allChapterIds = CHAPTERS.map(ch => ch.id);
            saveLockedChapters(allChapterIds);
            renderChapterLockList();
        });

        // Unlock all chapters
        unlockAllBtn.addEventListener('click', () => {
            saveLockedChapters([]);
            renderChapterLockList();
        });

        // Initial render
        renderChapterLockList();

        // Populate catalog table from media.js
        const catalogBody = document.getElementById('catalogBody');

        // Filter to only show non-placeholder media that's actually used
        const activeMedia = Object.entries(MEDIA_CONTENT)
            .filter(([id, media]) => !media.placeholder && media.src)
            .map(([id, media]) => ({
                id,
                icon: media.emoji || 'ðŸ“·',
                type: media.type,
                chapter: media.chapter ? chapterTitles[media.chapter - 1] : findChapterForMedia(id),
                caption: media.caption
            }));

        // Find which chapter a media ID is used in (by searching chapter content)
        function findChapterForMedia(mediaId) {
            for (let i = 0; i < CHAPTERS.length; i++) {
                if (CHAPTERS[i].content.includes(`data-media-id="${mediaId}"`)) {
                    return chapterTitles[i];
                }
            }
            return 'â€”';
        }

        // Render table
        function renderTable(data) {
            catalogBody.innerHTML = data.map(item => `
                <tr>
                    <td class="emoji-cell">${item.icon}</td>
                    <td>${item.id}</td>
                    <td>${item.chapter || 'â€”'}</td>
                    <td>${item.type}</td>
                </tr>
            `).join('');
        }

        renderTable(activeMedia);

        // Toggle functionality
        function loadSettings() {
            return {
                showOverload: localStorage.getItem('admin_showOverload') === 'true',
                showLockedPreviews: localStorage.getItem('admin_showLockedPreviews') === 'true',
                showCaptions: localStorage.getItem('admin_showCaptions') === 'true',
                allowDarkMode: localStorage.getItem('admin_allowDarkMode') !== 'false',
                allowPageMode: localStorage.getItem('admin_allowPageMode') !== 'false',
                allowFontSize: localStorage.getItem('admin_allowFontSize') !== 'false',
                allowBookmarks: localStorage.getItem('admin_allowBookmarks') !== 'false',
                randomButtonText: localStorage.getItem('admin_randomButtonText') === 'true',
                credentialCarousel: localStorage.getItem('admin_credentialCarousel') === 'true'
            };
        }

        function saveSetting(key, value) {
            localStorage.setItem('admin_' + key, value);
        }

        function init() {
            const settings = loadSettings();

            document.getElementById('showOverload').checked = settings.showOverload;
            document.getElementById('showLockedPreviews').checked = settings.showLockedPreviews;
            document.getElementById('showCaptions').checked = settings.showCaptions;
            document.getElementById('allowDarkMode').checked = settings.allowDarkMode;
            document.getElementById('allowPageMode').checked = settings.allowPageMode;
            document.getElementById('allowFontSize').checked = settings.allowFontSize;
            document.getElementById('allowBookmarks').checked = settings.allowBookmarks;
            document.getElementById('randomButtonText').checked = settings.randomButtonText;
            document.getElementById('credentialCarousel').checked = settings.credentialCarousel;

            // Add listeners for all toggles
            const toggles = ['showOverload', 'showLockedPreviews', 'showCaptions', 'allowDarkMode',
                           'allowPageMode', 'allowFontSize', 'allowBookmarks', 'randomButtonText', 'credentialCarousel'];

            toggles.forEach(id => {
                document.getElementById(id).addEventListener('change', (e) => {
                    saveSetting(id, e.target.checked);
                });
            });
        }

        // Media form functionality
        const addBtn = document.getElementById('addMediaBtn');
        const addForm = document.getElementById('addForm');
        const cancelBtn = document.getElementById('cancelBtn');
        const generateBtn = document.getElementById('generateBtn');
        const outputSection = document.getElementById('outputSection');
        const mediaCodeEl = document.getElementById('mediaCode');
        const spanCodeEl = document.getElementById('spanCode');
        const chapterSelect = document.getElementById('mediaChapter');

        // Chapter titles for dropdown
        const chapters = [
            'TRUST THE PROCESS', 'GRAPEFRUIT', 'EARNING IT', 'A CAGED TIGER',
            'THE BIGS', 'HITTERS COUNT', 'THE HOT STOVE', 'FIRE DRILL',
            'PRIME-TIME', 'GLOBETROTTING', 'THE OTHER SHOE', 'UNETHICAL',
            'CHANGE OF SCENERY', 'ENEMY LINES', 'A LETTER TO THE EDITOR',
            'TURNING POINT', 'OPENING DAY', 'MAGIC NUMBER', 'OCTOBER',
            'HOT COFFEE', 'THE FUTURE', 'THE WHITE FLAG', 'INSIDE BASEBALL',
            'BURN OUT', 'THE BIG ONE', 'ROAD TO OMAHA'
        ];

        // Populate chapter dropdown
        chapters.forEach((title, i) => {
            const opt = document.createElement('option');
            opt.value = i + 1;
            opt.textContent = `${i + 1}. ${title}`;
            chapterSelect.appendChild(opt);
        });

        const iconMap = {
            photo: 'ðŸ“·',
            newspaper: 'ðŸ“°',
            link: 'ðŸ”—',
            tweet: 'ðŸ¦',
            email: 'âœ‰ï¸',
            text: 'ðŸ’¬',
            video: 'ðŸŽ¬',
            audio: 'ðŸŽ™ï¸'
        };

        addBtn.addEventListener('click', () => {
            addForm.classList.add('active');
        });

        cancelBtn.addEventListener('click', () => {
            addForm.classList.remove('active');
            outputSection.style.display = 'none';
        });

        generateBtn.addEventListener('click', () => {
            const chapter = chapterSelect.value;
            const chapterTitle = chapterSelect.options[chapterSelect.selectedIndex].text;
            const type = document.getElementById('mediaType').value;
            const caption = document.getElementById('mediaCaption').value;
            const filename = document.getElementById('mediaSrc').value;
            const icon = iconMap[type] || 'ðŸ“·';

            // Generate a simple ID from chapter and type
            const id = `ch${chapter}-${type}-${Date.now().toString().slice(-4)}`;

            const mediaCode = `    '${id}': {
        type: '${type}',
        icon: '${icon}',
        label: '${type.charAt(0).toUpperCase() + type.slice(1)}',
        caption: '${caption}',
        src: './assets/${filename}',
        chapter: ${chapter},
        placeholder: false
    },`;

            const spanCode = `<span class="media-icon" data-media-id="${id}">${icon}</span>`;

            mediaCodeEl.textContent = mediaCode;
            spanCodeEl.textContent = spanCode;
            outputSection.style.display = 'block';
        });

        // Copy buttons
        document.querySelectorAll('.copy-btn[data-target]').forEach(btn => {
            btn.addEventListener('click', () => {
                const target = document.getElementById(btn.dataset.target);
                navigator.clipboard.writeText(target.textContent);
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = 'Copy', 2000);
            });
        });

        // Table sorting
        const table = document.getElementById('catalogTable');
        const headers = table.querySelectorAll('th[data-sort]');
        let sortDir = {};
        let currentData = [...activeMedia];

        const sortKeys = { icon: 'icon', id: 'id', chapter: 'chapter', type: 'type' };

        headers.forEach(th => {
            th.addEventListener('click', () => {
                const col = th.dataset.sort;
                const key = sortKeys[col];

                // Toggle direction
                sortDir[col] = sortDir[col] === 'asc' ? 'desc' : 'asc';
                const dir = sortDir[col];

                // Update arrows
                headers.forEach(h => {
                    h.classList.remove('sorted');
                    h.querySelector('.sort-arrow').textContent = 'â†•';
                });
                th.classList.add('sorted');
                th.querySelector('.sort-arrow').textContent = dir === 'asc' ? 'â†‘' : 'â†“';

                // Sort data
                currentData.sort((a, b) => {
                    const aVal = (a[key] || '').toString();
                    const bVal = (b[key] || '').toString();
                    const cmp = aVal.localeCompare(bVal);
                    return dir === 'asc' ? cmp : -cmp;
                });

                // Re-render
                renderTable(currentData);
            });
        });

        init();
    </script>
</body>
</html>
